(function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,b.GIF=a()}})(function(){return function g(b,c,d){function a(h,i){if(!c[h]){if(!b[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(e)return e(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=c[h]={exports:{}};b[h][0].call(f.exports,function(c){var d=b[h][1][c];return a(d?d:c)},f,f.exports,g,b,c,d)}return c[h].exports}for(var e="function"==typeof require&&require,f=0;f<d.length;f++)a(d[f]);return a}({1:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,j,k;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))if(b=arguments[1],b instanceof Error)throw b;else{var l=new Error("Uncaught, unspecified \"error\" event. ("+b+")");throw l.context=b,l}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),k=c.slice(),e=k.length,j=0;j<e;j++)k[j].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&0<e&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;0<h--;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[],b},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(a,b){var c,d,e,f,g;g=navigator.userAgent.toLowerCase(),f=navigator.platform.toLowerCase(),c=g.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],e="ie"===c[1]&&document.documentMode,d={name:"version"===c[1]?c[3]:c[1],version:e||parseFloat("opera"===c[1]&&c[4]?c[4]:c[2]),platform:{name:g.match(/ip(?:ad|od|hone)/)?"ios":(g.match(/(?:webos|android)/)||f.match(/mac|win|linux/)||["other"])[0]}},d[d.name]=!0,d[d.name+parseInt(d.version,10)]=!0,d.platform[d.platform.name]=!0,b.exports=d},{}],3:[function(a,b){var c,d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty,h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},i=[].slice;c=a("events").EventEmitter,e=a("./browser.coffee"),d=function(a){function b(a){var b,d,e;for(d in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(a),c)e=c[d],null==(b=this.options)[d]&&(b[d]=e)}var c,d;return f(b,a),c={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},d={delay:500,copy:!1},b.prototype.setOption=function(a,b){if(this.options[a]=b,null!=this._canvas&&("width"===a||"height"===a))return this._canvas[a]=b},b.prototype.setOptions=function(a){var b,c,d;for(b in c=[],a)g.call(a,b)&&(d=a[b],c.push(this.setOption(b,d)));return c},b.prototype.addFrame=function(a,b){var c,e;for(e in null==b&&(b={}),c={},c.transparent=this.options.transparent,d)c[e]=b[e]||d[e];if(null==this.options.width&&this.setOption("width",a.width),null==this.options.height&&this.setOption("height",a.height),"undefined"!=typeof ImageData&&null!==ImageData&&a instanceof ImageData)c.data=a.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&a instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&a instanceof WebGLRenderingContext)b.copy?c.data=this.getContextData(a):c.context=a;else if(null!=a.childNodes)b.copy?c.data=this.getImageData(a):c.image=a;else throw new Error("Invalid image");return this.frames.push(c)},b.prototype.render=function(){var a,b,c,d;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var b,c,d;for(d=[],a=b=0,c=this.frames.length;0<=c?b<c:b>c;a=0<=c?++b:--b)d.push(null);return d}.call(this),c=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(a=b=0,d=c;0<=d?b<d:b>d;a=0<=d?++b:--b)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},b.prototype.abort=function(){for(var a;a=this.activeWorkers.shift(),null!=a;)this.log("killing active worker"),a.terminate();return this.running=!1,this.emit("abort")},b.prototype.spawnWorkers=function(){var b,c,d,a=Math.min;return b=a(this.options.workers,this.frames.length),function(){d=[];for(var a=c=this.freeWorkers.length;c<=b?a<b:a>b;c<=b?a++:a--)d.push(a);return d}.apply(this).forEach(function(a){return function(b){var c;return a.log("spawning worker "+b),c=new Worker(a.options.workerScript),c.onmessage=function(b){return a.activeWorkers.splice(a.activeWorkers.indexOf(c),1),a.freeWorkers.push(c),a.frameFinished(b.data)},a.freeWorkers.push(c)}}(this)),b},b.prototype.frameFinished=function(a){var b,c,d;if(this.log("frame "+a.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[a.index]=a,!0===this.options.globalPalette&&(this.options.globalPalette=a.globalPalette,this.log("global palette analyzed"),2<this.frames.length))for(b=c=1,d=this.freeWorkers.length;1<=d?c<d:c>d;b=1<=d?++c:--c)this.renderNextFrame();return 0<=h.call(this.imageParts,null)?this.renderNextFrame():this.finishRendering()},b.prototype.finishRendering=function(){var b,c,d,e,f,g,h,m,n,o,p,q,r,s,t,u,a=Math.round;for(m=0,s=this.imageParts,f=0,n=s.length;f<n;f++)c=s[f],m+=(c.data.length-1)*c.pageSize+c.cursor;for(m+=c.pageSize-c.cursor,this.log("rendering finished - filesize "+a(m/1e3)+"kb"),b=new Uint8Array(m),q=0,t=this.imageParts,g=0,o=t.length;g<o;g++)for(c=t[g],u=c.data,d=h=0,p=u.length;h<p;d=++h)r=u[d],b.set(r,q),q+=d===c.data.length-1?c.cursor:c.pageSize;return e=new Blob([b],{type:"image/gif"}),this.emit("finished",e,b)},b.prototype.renderNextFrame=function(){var a,b,c;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(a=this.frames[this.nextFrame++],c=this.freeWorkers.shift(),b=this.getTask(a),this.log("starting frame "+(b.index+1)+" of "+this.frames.length),this.activeWorkers.push(c),c.postMessage(b))},b.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},b.prototype.getImageData=function(a){var b;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),b=this._canvas.getContext("2d"),b.setFill=this.options.background,b.fillRect(0,0,this.options.width,this.options.height),b.drawImage(a,0,0),this.getContextData(b)},b.prototype.getTask=function(a){var b,c;if(b=this.frames.indexOf(a),c={index:b,last:b===this.frames.length-1,delay:a.delay,transparent:a.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===e.name},null!=a.data)c.data=a.data;else if(null!=a.context)c.data=this.getContextData(a.context);else if(null!=a.image)c.data=this.getImageData(a.image);else throw new Error("Invalid frame");return c},b.prototype.log=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],this.options.debug?console.log.apply(console,a):void 0},b}(c),b.exports=d},{"./browser.coffee":2,events:1}]},{},[3])(3)});